# cse6242-homework-3-spark-docker-databricks-aws-and-gcp-solved
**TO GET THIS SOLUTION VISIT:** [CSE6242 Homework 3-Spark, Docker, DataBricks, AWS and GCP Solved](https://www.ankitcodinghub.com/product/cse6242-homework-3-spark-docker-databricks-aws-and-gcp-solved/)


---

üì© **If you need this solution or have special requests:** **Email:** ankitcoding@gmail.com  
üì± **WhatsApp:** +1 419 877 7882  
üìÑ **Get a quote instantly using this form:** [Ask Homework Questions](https://www.ankitcodinghub.com/services/ask-homework-questions/)

*We deliver fast, professional, and affordable academic help.*

---

<h2>Description</h2>



<div class="kk-star-ratings kksr-auto kksr-align-center kksr-valign-top" data-payload="{&quot;align&quot;:&quot;center&quot;,&quot;id&quot;:&quot;70247&quot;,&quot;slug&quot;:&quot;default&quot;,&quot;valign&quot;:&quot;top&quot;,&quot;ignore&quot;:&quot;&quot;,&quot;reference&quot;:&quot;auto&quot;,&quot;class&quot;:&quot;&quot;,&quot;count&quot;:&quot;5&quot;,&quot;legendonly&quot;:&quot;&quot;,&quot;readonly&quot;:&quot;&quot;,&quot;score&quot;:&quot;5&quot;,&quot;starsonly&quot;:&quot;&quot;,&quot;best&quot;:&quot;5&quot;,&quot;gap&quot;:&quot;4&quot;,&quot;greet&quot;:&quot;Rate this product&quot;,&quot;legend&quot;:&quot;5\/5 - (5 votes)&quot;,&quot;size&quot;:&quot;24&quot;,&quot;title&quot;:&quot;CSE6242 Homework 3-Spark, Docker, DataBricks, AWS and GCP Solved&quot;,&quot;width&quot;:&quot;138&quot;,&quot;_legend&quot;:&quot;{score}\/{best} - ({count} {votes})&quot;,&quot;font_factor&quot;:&quot;1.25&quot;}">

<div class="kksr-stars">

<div class="kksr-stars-inactive">
            <div class="kksr-star" data-star="1" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="2" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="3" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="4" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="5" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>

<div class="kksr-stars-active" style="width: 138px;">
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>
</div>


<div class="kksr-legend" style="font-size: 19.2px;">
            5/5 - (5 votes)    </div>
    </div>
Many modern-day datasets are huge and truly exemplify ‚Äúbig data‚Äù. For example, the Facebook social graph is petabytes large (over 1M GB); every day, Twitter users generate over 12 terabytes of messages; and the NASA Terra and Aqua satellites each produce over 300 GB of MODIS satellite imagery per day. These raw data are far too large to even fit on the hard drive of an average computer, let alone to process and analyze. Luckily, there are a variety of modern technologies that allow us to process and analyze such large datasets in a reasonable amount of time. For the bulk of this assignment, you will be working with a dataset of over 1 billion individual taxi trips from the New York City Taxi &amp; Limousine Commission (TLC). Further details on this dataset are available <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">here</a><a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">.</a>

In Q1, you will work with a subset of the TLC dataset to get warmed up with PySpark. Apache Spark is a framework for distributed computing, and PySpark is its Python API. You will use this tool to answer questions such as ‚Äúwhat are the top 10 most common trips in the dataset‚Äù? You will be using your own machine for computation, using an environment defined by a Docker container.

In Q2, you will perform further analysis on a different subset of the TLC dataset using Spark on DataBricks, a platform combining datasets, machine learning models, and cloud compute. This part of the assignment will be completed in the Scala programming language, a modern general-purpose language with a robust support for functional programming. The Spark distributed computing framework is in fact written using Scala.

In Q3, you will use PySpark on AWS using Elastic MapReduce (EMR), and in Q4 you will use Spark on Google Cloud Platform, to analyze even larger samples from the TLC dataset.

Finally, in Q5 you will use the Microsoft Azure ML Studio to implement a regression model to predict automobile prices using a sample dataset already included in the Azure workspace. A main goal of this assignment is to help students gain exposure to a variety of tools that will be useful in the future (e.g., future project, research, career). The reasoning behind intentionally including AWS, Azure and GCP (most courses use only one), because we want students to be able to try and compare these platforms as they evolve rapidly. This will help the students in the future should they need to select a cloud platform to use, they can make more informed decisions and be able to get started right away.

You will find that a number of computational tasks in this assignment are not very difficult, and there seems to be quite a bit of ‚Äúsetup‚Äù to do before getting to the actual ‚Äúprogramming‚Äù part of the problem. The reasoning behind this design is because for many students, this assignment is the very first time they use <em>any</em> cloud services; they are new to the pay-per-use model, and they have never used a cluster of machines. There are over 1000 students in CSE 6242 (campus and online) and CX 4242 combined. This means we have students coming from a great variety of backgrounds. We wished we could provide every student unlimited AWS credit so that they can try out many services and write programs that are more complex. Over the past offering of this course, we have been gradually increasing the ‚Äúprogramming‚Äù part and reducing much of the ‚Äúsetup‚Äù (e.g., the use of Docker, Databricks and Jupyter notebooks were major improvements). We will continue to further reduce the setup that students need to perform in future offerings of this course.

<h1>Q1 [15 points] Analyzing trips data with PySpark</h1>
Follow <a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/DockerSetup.pdf">these instructions</a> to download and setup a preconfigured Docker image that you will use for this assignment.

&nbsp;

<strong>Why use Docker?</strong> In earlier iterations of this course, students installed software on their own machines, and we (both students and instructor team) ran into all sorts of issues, some of which could not be resolved satisfactorily. Docker allows us to distribute a cross platform, preconfigured image with all of the requisite software and correct package versions. Once Docker is installed and the container is running, access Jupyter by browsing to <a href="http://localhost:6242/">http://localhost:6242</a><a href="http://localhost:6242/">.</a> There is no need to install any additional Java or PySpark dependencies as they are all bundled as part of the Docker container.

&nbsp;

Imagine that your boss gives you a large dataset which contains trip information of New York City Taxi and Limousine Commission (TLC). You are asked to provide summaries for the most common trips, as well as information related to fares and traffic. This information might help in positioning taxis depending on the demand at each location.

&nbsp;

You are provided with a Jupyter notebook (q1.ipynb) file which you will complete using PySpark using the provided Docker image.

<h2>Tasks</h2>
You will use the yellow_tripdata_2019-01_short.csv dataset. This dataset is a modified record of the NYC Green Taxi trips and includes information about the pick-up and drop-off dates/times, pick-up and drop-off locations, trip distances, fare amounts, payment types, and driver-reported passenger counts. When processing the data or performing calculations, <strong>do not round any values</strong>. Download the data <a href="https://www.dropbox.com/s/vog7s8suy9c3u87/yellow_tripdata_2019-01_short.csv?dl=1">here</a><a href="https://www.dropbox.com/s/vog7s8suy9c3u87/yellow_tripdata_2019-01_short.csv?dl=1">.</a>

&nbsp;

<ol>
<li>You will be modifying the function clean_data to clean the data. Cast the following columns into the specified data types:
<ol>
<li>passenger_count ‚Äì integer</li>
<li>total_amount ‚Äì float</li>
<li>tip_amount ‚Äì float</li>
<li>trip_distance ‚Äì float</li>
<li>fare_amount ‚Äì float</li>
<li>tpep_pickup_datetime ‚Äì timestamp</li>
<li>tpep_dropoff_datetime ‚Äì timestamp</li>
</ol>
</li>
</ol>
<strong>&nbsp;</strong>

<ol>
<li>&nbsp;You will be modifying the function common_pair. Find the top 10 pickup-dropoff location pairs having the highest number of trips (count). The location pairs should be ordered by count in descending order. If two or more pairs have the same number of trips, break the tie using the trip amount per distance travelled (trip_rate). Use columns total_amount and trip_distance to calculate the trip amount per distance. In certain situations, the pickup and dropoff locations may be the same (include such entries as well).</li>
</ol>
&nbsp;

Output:

<table width="569">
<tbody>
<tr>
<td width="137">PULocationID</td>
<td width="144">DOLocationID</td>
<td width="144">Count</td>
<td width="144">trip_rate</td>
</tr>
<tr>
<td width="137">1</td>
<td width="144">2</td>
<td width="144">23</td>
<td width="144">5.242345</td>
</tr>
<tr>
<td width="137">3</td>
<td width="144">3</td>
<td width="144">5</td>
<td width="144">6.61345634</td>
</tr>
</tbody>
</table>
<strong>&nbsp;</strong>

<ol>
<li><strong>[4 pts]</strong> You will be modifying the function Divide each day into two periods: Day (from 9am to 8:59:59pm, both inclusive), and Night (from 9pm to 8:59:59am, both inclusive). Calculate the average total amount per unit distance travelled (use column total_amount) for both time periods. Sort the result by trip_rate in ascending order to determine when the fare rate is the cheapest. Output:</li>
</ol>
<table width="281">
<tbody>
<tr>
<td width="137">day_night</td>
<td width="144">trip_rate</td>
</tr>
<tr>
<td width="137">Day</td>
<td width="144">4.2632344561</td>
</tr>
<tr>
<td width="137">Night</td>
<td width="144">6.42342882</td>
</tr>
</tbody>
</table>
<strong>&nbsp;</strong>

<ol>
<li><strong>[4 pts]</strong> You will be modifying the function passenger_count_for_most_tip . Filter the data for trips having fares (fare_amount) greater than $2 and the number of passengers</li>
</ol>
(passenger_count) greater than 0. Calculate the average fare and tip (tip_amount) for all passenger group sizes and calculate the tip percent (tip_amount * 100 / fare_amount). Sort the result in descending order of tip percent to obtain the group size that tips the most generously.

<strong>&nbsp;</strong>

Output:

<table width="281">
<tbody>
<tr>
<td width="137">passenger_count</td>
<td width="144">tip_percent</td>
</tr>
<tr>
<td width="137">2</td>
<td width="144">14.22345234</td>
</tr>
<tr>
<td width="137">1</td>
<td width="144">12.523334576</td>
</tr>
<tr>
<td width="137">3</td>
<td width="144">12.17345231</td>
</tr>
</tbody>
</table>
&nbsp;

<ol>
<li>&nbsp;You will be modifying the function day_with_traffic . Sort the days of the week in descending order of traffic (day having the highest traffic should be at the top). Calculate traffic for a particular day using the average speed of all taxi trips on that day of the week. Calculate speed using the trip time and trip distance, as distance per hour. If the average_speed is equal for multiple days, order the days alphabetically. A day with low average speed indicates high levels of traffic. The average speed may be 0 indicating very high levels of traffic. Not all days of the week may be present in the data (Do not include these missing days of the week in your output). Use date_format along with the appropriate <a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">pattern letters</a> to format the day of the week such that it matches the example output below.</li>
</ol>
&nbsp;

Output:

<table width="241">
<tbody>
<tr>
<td width="114">day_of_week</td>
<td width="127">average_speed</td>
</tr>
<tr>
<td width="114">Fri</td>
<td width="127">0.953452345</td>
</tr>
<tr>
<td width="114">Mon</td>
<td width="127">5.2424622</td>
</tr>
<tr>
<td width="114">Tue</td>
<td width="127">9.23345272</td>
</tr>
</tbody>
</table>
<strong>&nbsp;Deliverables: </strong>

<strong>&nbsp;[15 points] q1.ipynb </strong>the notebook for the given question with your code

<ol>
<li><strong>[1 pt]</strong> clean_data to clean the data</li>
<li><strong>[4 pts] </strong>common_pair to find the top 10 pickup-dropoff pairs</li>
<li><strong>[4 pts] </strong>time_of_cheapest_fare to find when the trips are cheapest (Day vs Night)</li>
<li><strong>[3 pts] </strong>passenger_count_for_most_tip to find which group size tips most generously</li>
<li><strong>[3 pts] </strong>day_with_traffic to find which day has the highest traffic (slowest trips)</li>
</ol>
<h1>Q2 Analyzing dataset with Spark/Scala on Databricks</h1>
<strong>Tutorial</strong>

First, go over this <a href="https://databricks.com/spark/getting-started-with-apache-spark/quick-start">Spark on Databricks Tutorial</a><a href="https://databricks.com/spark/getting-started-with-apache-spark/quick-start">,</a> to learn the basics of creating Spark jobs, loading data, and working with data.

&nbsp;

You will analyze nyc-tripdata.csv<a href="#_ftn1" name="_ftnref1"><sup>[1]</sup></a> using Spark and <a href="https://docs.scala-lang.org/overviews/index.html">Scala</a> on the Databricks platform. (A short description of how Spark and Scala are related can be found <a href="https://pediaa.com/what-is-the-difference-between-spark-and-scala/#:~:text=The%20main%20difference%20between%20Spark,functional%20and%20object%2Doriented%20programming.&amp;text=On%20the%20other%20hand%2C%20Scala%20is%20a%20programming%20language.">here</a><a href="https://pediaa.com/what-is-the-difference-between-spark-and-scala/#:~:text=The%20main%20difference%20between%20Spark,functional%20and%20object%2Doriented%20programming.&amp;text=On%20the%20other%20hand%2C%20Scala%20is%20a%20programming%20language.">.</a>) You will also need to use the taxi zone lookup table using taxi_zone_lookup.csv that maps the location ID into the actual name of the region in NYC. The nyctripdata dataset is a modified record of the NYC Green Taxi trips and includes information about the pick-up and drop-off dates/times, pick-up and drop-off locations, trip distances, fare amounts, payment types, and driver-reported passenger counts.

&nbsp;

<h2><strong>VERY IMPORTANT&nbsp; </strong></h2>
<ol>
<li>Use only <strong>Firefox, Safari or Chrome</strong> when configuring anything related to Databricks. The setup process has been verified to work on these browsers.</li>
<li><strong>Carefully </strong>follow the instructions in the <a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/DatabricksSetup.pdf">Databricks Setup Guide</a><a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/DatabricksSetup.pdf">.</a> Open the link in a private browser window if you get ‚ÄòPermission Denied‚Äô message.
<ol start="6">
<li>You <strong>must</strong> choose the Databricks Runtime (DBR) version as ‚Äú<strong>6 (includes Apache Spark 2.4.5, Scala 2.11)</strong>‚Äù. We will grade your work using this version.</li>
<li>You <strong>must not</strong> choose the default DBR version of &gt;= 7.2</li>
<li>Note that you do not need to install Scala or spark in your local machine. They are provided with the DBR environment.</li>
</ol>
</li>
<li><strong>You must use only</strong> Scala DataFrame operations for this question. Scala DataFrames are just another name for Spark DataSet of rows. You can use <a href="https://spark.apache.org/docs/2.4.5/api/scala/index.html#org.apache.spark.sql.Dataset">DataSet</a> <a href="https://spark.apache.org/docs/2.4.5/api/scala/index.html#org.apache.spark.sql.Dataset">API</a> in Spark to work on these DataFrames. <a href="https://spark.apache.org/docs/2.4.5/sql-programming-guide.html">Here</a> is a Spark document that will help you get started on working with DataFrames in Spark. You will lose points if you use SQL queries, Python, or R to manipulate a DataFrame.
<ol>
<li>Refer to this <a href="https://docs.databricks.com/notebooks/notebooks-use.html#language-magic">link</a> to understand how to avoid using other languages. After selecting the default language as SCALA, do not use the language magic %&lt;language&gt; with other languages like %r, %python, %sql etc. The language magics are used to override the default language, which you <strong>must not</strong> do for this assignment.</li>
<li>You <strong>must not</strong> use full SQL queries in lieu of the Spark DataFrame API. That is, you <strong>must not</strong> use functions like <em>sql()</em>, which allows you to directly write full SQL queries like spark.sql (‚ÄúSELECT* FROM col1 WHERE ‚Ä¶‚Äù). This should be df.select(‚Äú*‚Äù) instead.</li>
</ol>
</li>
<li>The provided template Scala notebook <em>dbc</em> (in hw3-skeleton) has provided you with code that reads in a data file <em>nyc-tripdata.csv. </em>The input data is loaded into a DataFrame, inferring the schema using reflection (Refer to the Databricks Setup Guide above). It also contains code that <strong>filters the data</strong> to only keep the rows where the pickup location is different from the drop location, and the trip distance is strictly greater than 2.0 (&gt;2.0).
<ol>
<li>All tasks listed below <strong>must</strong> be performed on this filtered DataFrame.</li>
<li>Carefully read the instructions in the notebook, which include hints for solving the problems.</li>
</ol>
</li>
</ol>
&nbsp;

<h3>Tasks</h3>
<ol>
<li>List the top-5 most popular drop locations for:</li>
<li><strong>[2 pts]</strong> ‚ÄúDOLocationID‚Äù, sorted in descending order. If there is a tie, then one with a lower ‚ÄúDOLocationID‚Äù gets listed first. ii. <strong>[2 pts]</strong>‚ÄúPULocationID‚Äù, sorted in descending order. If there is a tie, then one with a lower ‚ÄúPULocationID‚Äù gets listed first.</li>
<li><strong>[4 pts]</strong> List the top-3 locationID‚Äôs with the maximum overall activity. Here number of overall activity in a LocationID is simply the sum of all pickups and all drop offs at that LocationID. In case of a tie, the lower LocationID gets listed first.</li>
<li><strong>[4 pts]</strong> List all the boroughs (of NYC: Manhattan, Brooklyn, Queens, Staten Island, Bronx along with ‚ÄúUnknown‚Äù and ‚ÄúEWR‚Äù) in the order of having the highest to lowest number of activities (here number of activities means the sum of all pickups and all drop offs at that LocationID), together with the total number of activity counts for each borough in NYC.</li>
<li><strong>[5 pts]</strong> List the top 2 days of week with the largest number of (daily) average pickups, along with the values of average number of pickups on each of the two days. The day of week should be a string with its full name, for example, ‚ÄúMonday‚Äù instead of a number 1 or ‚ÄúMon‚Äù.</li>
<li><strong>[6 pts]</strong> For each particular hour of a day (0 to 23, 0 being midnight) ‚Äì in their order from 0 to 23 (inclusive), find the zone in Brooklyn borough with the LARGEST number of pickups.</li>
<li><strong>[7 pts]</strong> Find which 3 different days of the January, in Manhattan, saw the largest percentage increment in pickups compared to previous day, in the order from largest increment % to smallest increment %.</li>
</ol>
&nbsp;

List the results of the above tasks in the provided <strong>q2_results.csv</strong> file under the relevant sections. <strong>These preformatted sections also show you the required output format from your Scala code with the necessary columns ‚Äî while column names can be different, their resulting values must be correct.</strong>

<ul>
<li>You must <strong>manually enter</strong> the output generated into the corresponding sections of the <em>csv</em> file, preferably using some spreadsheet software like MS-Excel (but make sure to keep the csv format). For generating the output in the Scala notebook, refer to show() and display()functions of Scala.</li>
<li>Note that you can edit this csv file using text editor, but please be mindful about putting the results under designated columns.</li>
</ul>
Do not modify anything other than filling in those required output values on this csv file. <strong>We grade by running the Spark Scala code you write and also by looking at your results listed in this file</strong>. So, make sure that your output is actually obtained from the Spark Scala code you write.

<strong>Hint: </strong>You may find some of the following DataFrame operations helpful:

toDF, join, select, groupBy, orderBy, filter, agg, Window(), partitionBy, orderBy etc.

<h3>Deliverables</h3>
&nbsp;

<strong>VERY IMPORTANT:</strong> Rename your notebook as <strong>q2_yourGTusername</strong> (e.g., q2_jdoe3) and export your solution in the three formats: .dbc, .scala and .html.

<ul>
<li><strong>dbc: </strong>Your solution as Scala Notebook archive file (.dbc) exported from Databricks. See the Databricks Setup Guide on creating an exportable archive for details.</li>
<li><strong>scala</strong>: Your solution as a Scala source file exported from Databricks. See the Databricks Setup Guide on creating an exportable source file for details.</li>
<li><strong>html</strong>: Your solution as a HTML file exported from Databricks. See the Databricks Setup Guide on how to export your code as an HTML.</li>
</ul>
&nbsp;

<strong>q2_results.csv:</strong> The output results from your Scala code in the Databricks q2 notebook file. You must carefully copy the outputs of the <em>display()</em>/<em>show()</em> function into a file titled <strong><em>q2_results.csv</em> </strong>under the relevant sections. Please double check and compare with your actual output with the results you copied.

<h1>Q3 Analyzing Large Amount of Data with PySpark on AWS</h1>
<strong>VERY IMPORTANT</strong>: Use Firefox, Safari or Chrome when configuring anything related to AWS.

&nbsp;

You will try out PySpark for processing data on Amazon Web Services (AWS). <a href="https://spark.apache.org/docs/0.9.0/python-programming-guide.html">Here</a> you can learn more about PySpark and how it can be used for <a href="https://medium.com/@aieeshashafique/exploratory-data-analysis-using-pyspark-dataframe-in-python-bd55c02a2852">data analysis</a><a href="https://medium.com/@aieeshashafique/exploratory-data-analysis-using-pyspark-dataframe-in-python-bd55c02a2852">.</a> You will be completing a task that may be accomplished using a commodity computer (e.g., consumer-grade laptops or desktops). However, we would like you to use this exercise as an opportunity to learn distributed computing on Amazon EC2, and to gain experience that will help you tackle more complex problems.

&nbsp;

The services you will primarily be using are Amazon S3 storage, Amazon Elastic Cloud Computing (EC2) virtual servers in the cloud, and Amazon Elastic MapReduce (EMR) managed Hadoop framework. You will be creating an S3 bucket, running code through EMR, then storing the output into that S3 bucket.

&nbsp;

For this question, you will only use up a very small fraction of your AWS credit.

<h2>AWS Guidelines</h2>
Please read the <a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/AWSSetup.pdf">AWS Setup Tutorial</a> to set up your AWS account. Instructions are provided both as a written guide, and a video tutorial.

<h2>Datasets</h2>
In this question, you will use a dataset of trip records provided by the New York City Taxi and Limousine Commision (TLC). Further details on this dataset are available <a href="https://registry.opendata.aws/nyc-tlc-trip-records-pds/">here</a> and <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">here</a><a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">.</a>&nbsp; From these pages <a href="https://docs.aws.amazon.com/quicksight/latest/user/explore-in-quicksight.html">[1]</a> <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html">[2]</a><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html">,</a> you can explore the structure of the data, however you will be accessing the dataset directly through AWS via the code outlined in the homework skeleton. You will be working with two samples of this data, one small, and one much larger.

&nbsp;

<strong>EXTREMELY IMPORTANT</strong>: Both the datasets are in the <strong>US East (N. Virginia)</strong> region. Using machines in other regions for computation would incur data transfer charges. Hence, set your region to <strong>US East (N. Virginia) </strong>in the beginning (not Oregon, which is the default). <strong>This is extremely important, otherwise your code may not work, and you may be charged extra.</strong>

<h2>Goal</h2>
You work at NYC TLC, and since the company bought a few new taxis, your boss has asked you to locate potential places where taxi drivers can pick up more passengers. Of course, the more profitable the locations are, the better. Your boss also tells you not to worry about short trips for <strong>any </strong>of your analysis, so only analyze trips which are<strong> 2 miles or longer</strong>.

&nbsp;

First, find the <strong>20 </strong>most popular drop off locations in the Manhattan borough by finding which of these destinations had the greatest <strong>passenger count</strong>.

&nbsp;

Now, analyze all pickup locations, regardless of borough.

<ul>
<li>For each pickup location determine o the <strong>average total amount</strong> per trip,
<ul>
<li>the total <strong>count</strong> of all trips that start at that location, and</li>
<li>the <strong>count </strong>of all trips that start at that location and end at one of most popular drop off locations.</li>
</ul>
</li>
<li>Using the above values, o determine the <strong>proportion</strong> of trips that end in one of the popular drop off locations (# trips that end in drop off location divided by total # of trips) and
<ul>
<li>multiply that proportion by the <strong>average total amount</strong> to get a <strong>weighted profit value</strong> based on the probability of passengers going to one of the popular destinations.</li>
</ul>
</li>
</ul>
&nbsp;

Bear in mind, your boss is not as savvy with the data as you are and is not interested in location IDs. To make it easy for your boss, provide the <strong>Borough </strong>and <strong>Zone </strong>for each of the top 20 pickup locations you determined. To help you evaluate the correctness of your output, we have provided you with <a href="https://www.dropbox.com/s/umz5fvypbee7szy/output-small.csv?dl=1">the output for</a> <a href="https://www.dropbox.com/s/umz5fvypbee7szy/output-small.csv?dl=1">the small dataset</a><a href="https://www.dropbox.com/s/umz5fvypbee7szy/output-small.csv?dl=1">.</a>

&nbsp;

<strong>Note</strong>: Please strictly follow the formatting requirements for your output as shown in the small dataset output file. You can use <a href="https://www.diffchecker.com/">https://www.diffchecker.com/</a> to make sure the formatting is correct. Improperly formatted outputs may not receive any points, as we may not know how to interpret them.

<h2>Tasks</h2>
You are provided with a python notebook (q3_pyspark.ipynb) file which you will complete and load into EMR. You are provided with the load_data() function, which loads two PySpark DataFrames. The first is <strong>trips</strong> which contains a DataFrame of trip data, where each record refers to one (1) trip. The second is <strong>lookup</strong> which maps a LocationID to its information. It can be linked to either the PULocationID or DOLocationID fields in the trips DataFrame.

&nbsp;

The following functions must be completed for full credit.

&nbsp;

<strong>VERY IMPORTANT </strong>

<ul>
<li>Ensure that the parameters for each function remain as defined and the output order and names of the fields in the PySpark DataFrames are maintained.</li>
<li>Do not import any functions which were not already imported within the skeleton.</li>
<li>Use PySpark methods to complete this assignment, not SQL commands.</li>
</ul>
&nbsp;

<ol>
<li><strong>[1 pts] user()</strong>
<ol>
<li>Returns your GT Username as a string (e.g., gburdell3)</li>
</ol>
</li>
<li><strong>[2 pts] long_trips(trips)</strong>
<ol>
<li>This function filters trips to keep only trips longer than 2 miles. ii. Returns PySpark DataFrame with the same schema as <strong>trips</strong></li>
</ol>
</li>
</ol>
iii. &nbsp;&nbsp;&nbsp;&nbsp; <strong>Note: Parts c, d and e will use the result of this function</strong>

<ol>
<li><strong>[6 pts] manhattan_trips(trips, lookup)</strong>
<ol>
<li>This function determines the top 20 locations with a <em>DOLocationID </em>in Manhattan by passenger count.</li>
<li>Returns a PySpark DataFrame with the schema (DOLocationID, pcount)</li>
</ol>
</li>
<li><strong>[6 pts] weighted_profit(trips, mtrips)</strong>
<ol>
<li>This function determines
<ol>
<li>the average <em>total_amount</em>,</li>
</ol>
</li>
</ol>
</li>
</ol>
&nbsp;

<ol>
<li>the<em> total count of trips</em>, and</li>
</ol>
<ul>
<li>the <em>total count of trips ending in the top 20 destinations</em></li>
</ul>
<ol>
<li>and return the <em>weighted_profit</em> as discussed earlier in the homework document.</li>
<li>Returns a PySpark DataFrame with the schema (PULocationID, weighted_profit) for the <em>weighted_profit</em> as discussed earlier in this homework document.</li>
<li></li>
</ol>
<ol>
<li><strong>[5 pts] final_output(wp, lookup)</strong>
<ol>
<li>This function
<ol>
<li>takes the results of <em>weighted_profit</em>,</li>
<li>links it to the <em>borough </em>and <em>zone </em>through the <strong>lookup </strong>data frame, and</li>
</ol>
</li>
</ol>
</li>
</ol>
<ul>
<li>returns the top 20 locations with the highest <em>weighted_profit</em>. ii. Returns a PySpark DataFrame with the schema (Zone, Borough, weighted_income)</li>
</ul>
&nbsp;

Once you have implemented all these functions, run the main() function, which is already implemented, and update the line of code to include the name of your output s3 bucket and a location. <strong>This function will fail</strong> if the output directory already exists, so make sure to <strong>change it each time</strong> you run the function.

Example: final.write.csv(‚Äòs3://cse6242-bburdell3/output3.csv‚Äô)

Your output file will appear in a folder in your s3 bucket as a csv file with a name which is similar to <em>part0000-4d992f7a-0ad3-48f8-8c72-0022984e4b50-c000.csv</em>. Download this file and <strong>rename it to q3_output.csv</strong> for submission. Do <strong>not </strong>make any other changes to the file.

&nbsp;

<strong>Hint:</strong> Refer to commands such as filter, join, groupBy, agg, limit, sort, withColumnRenamed and withColumn.

&nbsp;

<h2>Deliverables</h2>
<ol>
<li><strong>[20 pts] q3_pyspark.ipynb</strong>: The PySpark notebook for the question (using the <strong>larger</strong> data set).</li>
</ol>
&nbsp;

<ol start="2">
<li><strong>[15 pts] q3_output.csv</strong>: Output <strong>(comma-separated) </strong>(using the <strong>larger</strong> data set).</li>
</ol>
&nbsp;

<strong>Note: </strong>Please strictly follow the guidelines below, otherwise your answer may not be graded.

<ol>
<li>Ensure that file names (case sensitive) are correct.</li>
<li>Ensure file extensions (.csv, .ipynb) are correct.</li>
<li>Double check that you are submitting the correct set of files ‚Äî we only want the script and output</li>
</ol>
from the larger dataset. Also, double check that you are writing the right dataset‚Äôs output to the right file.

<ol start="4">
<li>You are welcome to store your script‚Äôs output in any bucket you choose, as long as you can download and submit the correct files.</li>
<li>Do not make any manual changes to the output files</li>
</ol>
&nbsp;

<h1>Q4 Analyzing a Large Dataset using Spark on GCP</h1>
<strong>VERY IMPORTANT</strong>: Use Firefox, Safari or Chrome when configuring anything related to GCP.

<h2>GCP Guidelines</h2>
Instructions to setup GCP Credits, GCP Storage and Dataproc Cluster are provided as a video tutorials (<a href="https://youtu.be/PdD5xDSNkhI">here</a> and <a href="https://youtu.be/z6m8PGjQ_iQ">here</a><a href="https://youtu.be/z6m8PGjQ_iQ">)</a> and also <a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/GCPSetup.pdf">written instructions</a><a href="https://poloclub.github.io/cse6242-2020fall-online/hw3/Setup_PDFDoc/GCPSetup.pdf">.</a>

<h2>Goal</h2>
The goal of this question is to familiarize you with creating storage buckets/clusters and running <a href="https://spark.apache.org/">Spark</a> programs on <a href="https://cloud.google.com/">Google Cloud Platform</a><a href="https://cloud.google.com/">.</a> This question asks you to create a new Google Storage Bucket and load the NYC Taxi &amp; Limousine Commission Dataset. You are also provided with a Jupyter Notebook (q4_pyspark-gcp.ipynb) file which you will load and complete in Google Dataproc Cluster. Inside the notebook, you are provided with the load_data() function, which you will complete to load a PySpark DataFrame from the Google Storage Bucket you created as part of this question. Using this PySpark DataFrame, you will complete the following tasks.

<h2>Tasks</h2>
<ol>
<li><strong>[1 pts]</strong> Function load_data() to load data from Google Storage Bucket into Spark DataFrame</li>
<li><strong>[1.5 pts]</strong> Function exclude_no_pickuplocations() to exclude trips with no pickup locations</li>
<li><strong>[1.5 </strong>pts] Function exclude_no_tripdistance() to exclude trips with no distance</li>
<li><strong>[2 pts]</strong> Function include_fare_range() to include trips with fare between the range of $20 to $60 (including exact $20 and $60 fares)</li>
</ol>
&nbsp;

<strong>After performing all the above operations</strong> on the data in sequence, perform the following functions on the <strong>filtered data</strong>.

<ol>
<li><strong>[2 pts]</strong> Function get_highest_tip() to identify the highest tip in the filtered data. The Jupyter Notebook cell sequence automatically uses the filtered data</li>
<li><strong>[2 pts]</strong> Function get_total_toll() to calculate the total toll amount for the filtered data. The Jupyter Notebook cell sequence automatically uses the filtered data</li>
</ol>
&nbsp;

<strong>VERY IMPORTANT:&nbsp; you must first perform task a, b, c, and d in sequence, BEFORE performing task e and f.&nbsp; </strong>

&nbsp;

You will use the data file <a href="https://www.dropbox.com/s/btbr5rjg0vb53xr/hw3q4-data.zip?dl=1">yellow_tripdata_2019</a><a href="https://www.dropbox.com/s/btbr5rjg0vb53xr/hw3q4-data.zip?dl=1">‚Äì</a><a href="https://www.dropbox.com/s/btbr5rjg0vb53xr/hw3q4-data.zip?dl=1">01.</a><a href="https://www.dropbox.com/s/btbr5rjg0vb53xr/hw3q4-data.zip?dl=1">csv</a><a href="https://www.dropbox.com/s/btbr5rjg0vb53xr/hw3q4-data.zip?dl=1">.</a> Each line represents a single taxi trip consisting of following comma separated columns. All columns are of string data type. You must convert the highlighted columns below into float data type when completing this question:

<ul>
<li>VendorID</li>
<li>tpep_pickup_datetime</li>
<li>tpep_dropoff_datetime</li>
<li>passenger_count</li>
<li><strong>trip_distance (float data type)</strong></li>
<li>RatecodeID</li>
<li>store_and_fwd_flag</li>
<li>PULocationID</li>
<li>DOLocationID</li>
<li>payment_type</li>
<li><strong>fare_amount (float data type)</strong></li>
<li>extra</li>
<li>mta_tax</li>
<li><strong>tip_amount (float data type)</strong></li>
<li><strong>tolls_amount (float data type)</strong></li>
<li>improvement_surcharge</li>
<li>total_amount</li>
</ul>
&nbsp;

Deliverables:

<strong>q4_pyspark-gcp.ipynb: The PySpark notebook for the question. </strong>

<ol>
<li><strong>[1 pts] </strong>load_data() function to load data from google storage bucket into spark data frame</li>
<li><strong>[1.5 pts] </strong>exclude_no_pickuplocations() function to exclude trips with no pickup location</li>
<li><strong>[1.5 pts] </strong>exclude_no_tripdistance() function to exclude trips with no trip distance</li>
<li><strong>[2 pts] </strong>include_fare_range() function to include only the trips with fare amounts between $20 to $60</li>
</ol>
(including exact $20 and $60 fares)

<ol>
<li><strong>[2 pts] </strong>get_highest_tip() function to get the highest tip value</li>
<li><strong>[2 pts] </strong>get_total_toll() function to calculate the total toll amount for the subset of this dataset</li>
</ol>
<strong>&nbsp;</strong>

&nbsp;

<h1>Q5 [10 points] Regression: Automobile price prediction, using Azure ML Studio</h1>
<strong>Note</strong>: Create and use a free workspace instance on <a href="https://studio.azureml.net/">Azure Studio</a><a href="https://studio.azureml.net/">.</a> Please use your Georgia Tech username (e.g., jdoe3) to login.

Goal

<h2>Primary purpose of this question is to introduce you to Microsoft Azure Machine Learning Studio, familiarize you to its basic functionalities and typical machine learning workflows. Go through the ‚Äú<a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio/create-experiment">Automobile price prediction</a><a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio/create-experiment">‚Äù</a> tutorial and complete the following tasks.Tasks</h2>
You will manually modify the given file<strong>q5_results.csv </strong>by adding to it the results from the following tasks (e.g., using a plain text editor). Your solution will be autograded. Hence,

<ul>
<li>DO NOT change the order of the questions.</li>
<li>Report the exact numerical values that you get in your output, and DO NOT round any of them.</li>
<li>When manually entering a value into the csv file, append it immediately after a comma, so there will be NO space between the comma and your value, and no trailing spaces after your value.</li>
</ul>
&nbsp;

<ol start="3">
<li>Update your GT username in the q5_results.csv file to replace gburdell3.</li>
<li><strong>[3 pts]</strong> Repeat the experiment described in the tutorial and report values of all metrics as mentioned in the ‚Äò<em>Evaluate Model‚Äô</em> section of the tutorial.</li>
<li><strong>[3 pts] </strong>Repeat this experiment with a different value of ‚Äò<em>Fraction of rows in the first output‚Äô</em> in the split module. Change the value to 0.8 from the originally set value, 0.75. Report corresponding values of the metrics.</li>
<li><strong>[4 pts] </strong>Evaluate the model using 5-fold cross-validation (<a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio/evaluate-model-performance">CV</a><a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio/evaluate-model-performance">)</a>. Select parameters in the module <em>‚ÄòPartition and sample‚Äô</em> <a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/partition-and-sample">(</a><a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/partition-and-sample">Partition and Sample</a><a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/partition-and-sample">)</a> in accordance with the figure below. Report the values of Root Mean Squared Error (RMSE) and Coefficient of Determination for each of the five folds (1st fold corresponds to fold number 0 and so on).</li>
</ol>
&nbsp;

To summarize, in order to complete sub question (d), you need to complete the following:

<ol>
<li>Import the entire dataset (Automobile Price Data (Raw))</li>
<li>Clean the missing data by dropping rows with missing values (Do not ‚Äúexclude the normalized losses‚Äù from the original tutorial) C. Partition and sample the data.</li>
<li>Create a new model: Linear Regression (add the default Linear regression i.e. do not change any values here)</li>
<li>Finally, perform cross validation on the dataset.</li>
<li>Visualize/report the values.</li>
</ol>
&nbsp;

Figure: Property Tab of Partition and Sample Module

&nbsp;

<strong>Hint</strong>: For part 4, follow each of the outline steps carefully. This should result in 5 blocks in your final workflow (including the Automobile price data (Raw) block).

&nbsp;

Deliverables

<ol>
<li><strong> [10pt] q5_results.csv:</strong> a csv file containing results for all of the three parts. <strong>&nbsp;</strong></li>
</ol>
<h1><strong>Extremely Important:</strong> folder structure &amp; content of submission zip file <sub>&nbsp;</sub></h1>
We understand that some of you may work on this assignment until just prior to the deadline, rushing to submit your work before the submission window closes.&nbsp; <strong>Please take the time</strong> to validate that <strong>all files</strong> are present in your submission and that you have not forgotten to include any deliverables!&nbsp; If a deliverable is not submitted, you will receive <strong>zero </strong>credit for the affected portion of the assignment ‚Äî this is a very sad way to lose points, since you have already done the work!

&nbsp;

You are submitting a single <strong>zip </strong>file <strong>HW3-GTusername.zip</strong> (e.g., HW3-jdoe3.zip).

&nbsp;

The files included in each question‚Äôs folder have been clearly specified at the end of the question‚Äôs problem description. <sub>&nbsp;</sub>

&nbsp;

The zip file‚Äôs folder structure must exactly be (when unzipped):

&nbsp;

HW3-GTUsername/

Q1/

q1.ipynb &nbsp;&nbsp;&nbsp;&nbsp;Q2/

q2_yourGTusername.dbc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; q2_yourGTusername.scala&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; q2_yourGTusername.html&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; q2_results.csv&nbsp;&nbsp;&nbsp;&nbsp; Q3/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q3_pyspark.ipynb &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q3_output.csv&nbsp;&nbsp;&nbsp;&nbsp; Q4/

q4_pyspark-gcp.ipynb <strong>&nbsp;&nbsp;&nbsp;&nbsp;</strong>Q5/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q5_results.csv

<strong>&nbsp;</strong>

&nbsp;

<a href="#_ftnref1" name="_ftn1"><u>[1]</u></a> <u>Graph derived from the </u><a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">NYC Taxi and Limousine Commission</a>
